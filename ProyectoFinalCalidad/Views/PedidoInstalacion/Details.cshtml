@model ProyectoFinalCalidad.Models.PedidoInstalacion

@{
    ViewData["Title"] = "Detalle del Pedido de Instalación";
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />

<style>
    :root {
        --primary: #009ffd;
        --accent: #6a4c93;
        --text-dark: #1e2a35;
        --text-light: #6b7280;
        --border: #d0d7de;
        --bg-light: #f9fafb;
        --success: #27ae60;
        --warning: #fbc02d;
        --danger: #e63946;
    }

    /* ===== CONTENEDOR PRINCIPAL ===== */
    .detalle-container {
        background: #ffffff;
        padding: 2rem;
        border-radius: 1rem;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
        margin: 4rem auto;
        transition: all 0.3s ease-in-out;
    }

    .detalle-header {
        font-weight: bold;
        color: #ffffff;
        background: linear-gradient(90deg, var(--primary), var(--accent));
        padding: 1rem 1.5rem;
        border-radius: 0.75rem 0.75rem 0 0;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .detalle-body {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
        padding: 2rem;
        background-color: white;
        border-radius: 0 0 0.75rem 0.75rem;
    }

    .detalle-card {
        background-color: #ffffff;
        border-left: 5px solid var(--primary);
        border-radius: 0.75rem;
        padding: 1.5rem;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.05);
        display: flex;
        flex-direction: column;
        justify-content: center;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

        .detalle-card:hover {
            transform: scale(1.02);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
        }

        .detalle-card h6 {
            font-size: 1rem;
            color: var(--text-light);
            margin-bottom: 0.25rem;
        }

        .detalle-card p {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-dark);
            margin: 0;
        }

    .resumen {
        grid-column: span 2;
        background: linear-gradient(90deg, var(--primary), var(--accent));
        color: white;
        border-radius: 0.75rem;
        padding: 1.5rem;
        text-align: center;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease-in-out;
    }

        .resumen:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 28px rgba(0, 0, 0, 0.12);
        }

        .resumen h4 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .resumen p {
            font-size: 1.1rem;
            margin: 0;
        }

    /* ===== BADGES ===== */
    .badge {
        font-weight: 600;
        font-size: 0.9rem;
        padding: 0.4rem 0.8rem;
        border-radius: 0.5rem;
        display: inline-block;
    }

    .badge-pendiente {
        background-color: var(--warning);
        color: #212529;
    }

    .badge-completado {
        background-color: var(--success);
        color: #fff;
    }

    .badge-cancelado {
        background-color: var(--danger);
        color: #fff;
    }

    /* ===== BOTÓN VOLVER ===== */
    .btn-back {
        font-weight: bold;
        padding: 0.75rem 1.6rem;
        font-size: 1.1rem;
        border-radius: 0.5rem;
        border: none;
        background-color: var(--primary);
        color: white;
        transition: all 0.3s ease, box-shadow 0.3s ease;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

        .btn-back:hover {
            background-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }

        .btn-back i {
            margin-right: 0.5rem;
        }

    /* ===== MODO NOCHE ===== */
    html[data-theme="dark"] .detalle-container,
    [data-bs-theme="dark"] .detalle-container,
    .dark-mode .detalle-container {
        background-color: #121212;
        color: #f1f1f1;
    }

    html[data-theme="dark"] .detalle-body,
    [data-bs-theme="dark"] .detalle-body,
    .dark-mode .detalle-body {
        background-color: #1e1e1e;
    }

    html[data-theme="dark"] .detalle-card,
    [data-bs-theme="dark"] .detalle-card,
    .dark-mode .detalle-card {
        background-color: #1e1e1e;
        border-left-color: var(--primary);
        color: #f1f1f1;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
    }

        html[data-theme="dark"] .detalle-card h6,
        [data-bs-theme="dark"] .detalle-card h6,
        .dark-mode .detalle-card h6 {
            color: #ccc;
        }

        html[data-theme="dark"] .detalle-card p,
        [data-bs-theme="dark"] .detalle-card p,
        .dark-mode .detalle-card p {
            color: #fff;
        }

    html[data-theme="dark"] .resumen,
    [data-bs-theme="dark"] .resumen,
    .dark-mode .resumen {
        background: #000;
        color: #fff;
        box-shadow: 0 8px 20px rgba(255, 255, 255, 0.08);
    }

    html[data-theme="dark"] .badge-pendiente,
    [data-bs-theme="dark"] .badge-pendiente,
    .dark-mode .badge-pendiente {
        background-color: #444;
        color: #fbc02d;
        border: 1px solid #666;
    }

    html[data-theme="dark"] .badge-completado,
    [data-bs-theme="dark"] .badge-completado,
    .dark-mode .badge-completado {
        background-color: #00c16e;
        color: #fff;
    }

    html[data-theme="dark"] .badge-cancelado,
    [data-bs-theme="dark"] .badge-cancelado,
    .dark-mode .badge-cancelado {
        background-color: #e63946;
        color: #fff;
    }

    html[data-theme="dark"] .btn-back,
    [data-bs-theme="dark"] .btn-back,
    .dark-mode .btn-back {
        background-color: #222;
        color: #fff;
    }

        html[data-theme="dark"] .btn-back:hover,
        [data-bs-theme="dark"] .btn-back:hover,
        .dark-mode .btn-back:hover {
            background-color: #444;
            color: #fff;
        }

</style>

<div class="container detalle-container">
    <div class="detalle-header">
        <i class="bi bi-eye-fill fs-3"></i> @ViewData["Title"]
    </div>

    <div class="detalle-body">
        <!-- Resumen Superior -->
        <div class="resumen">
            <h4><i class="bi bi-info-circle-fill"></i> Resumen de Pedido</h4>
            <p>
                Pedido registrado por <strong>@Model.Empleado?.nombres</strong> para el contrato del cliente
                <strong>@Model.Contrato?.Cliente?.Nombres</strong>.
            </p>
        </div>

        <div class="detalle-card">
            <h6>ID del Pedido</h6>
            <p>@Model.PedidoId</p>
        </div>

        <div class="detalle-card">
            <h6>Contrato</h6>
            <p>Contrato #@Model.Contrato?.Id</p>
            <small class="text-muted">Cliente: @Model.Contrato?.Cliente?.Nombres</small>
        </div>

        <div class="detalle-card">
            <h6>Empleado asignado</h6>
            <p>@Model.Empleado?.nombres</p>
        </div>

        <div class="detalle-card">
            <h6>Equipo secundario actual</h6>
            @{
                var secNombre = ViewBag.EquipoSecundarioNombre as string;
                var secCodigo = ViewBag.EquipoSecundarioCodigoUnidad as string;
            }
            @if (!string.IsNullOrWhiteSpace(secNombre) && !string.IsNullOrWhiteSpace(secCodigo))
            {
                <p>@secNombre</p>
                <small class="text-muted">Unidad: @secCodigo</small>
            }
            else
            {
                <p>Sin asignación</p>
                <small class="text-muted">No hay unidad secundaria vinculada</small>
            }
        </div>

        <div class="detalle-card">
            <h6>Jefe a cargo</h6>
            @{
                var cargoClaim = User.Claims.FirstOrDefault(c => c.Type == "Cargo")?.Value;
                var rolClaim = User.Claims.FirstOrDefault(c => c.Type == System.Security.Claims.ClaimTypes.Role)?.Value;

                string jefeACargo;

                if (!string.IsNullOrEmpty(rolClaim) && rolClaim == "Administrador")
                {
                    jefeACargo = "Administrador General";
                }
                else if (!string.IsNullOrEmpty(cargoClaim))
                {
                    jefeACargo = cargoClaim;
                }
                else
                {
                    jefeACargo = "Sin cargo";
                }
            }
            <p>@jefeACargo</p>
        </div>

        <div class="detalle-card">
            <h6>Fecha de instalación</h6>
            <p>@Model.FechaInstalacion?.ToString("dd/MM/yyyy")</p>
        </div>

        <div class="detalle-card">
            <h6>Estado</h6>
            @{
                var estado = Model.EstadoInstalacion?.ToLower() ?? "";
                string estadoClase = estado switch
                {
                    "pendiente" => "badge-pendiente",
                    "completado" => "badge-completado",
                    "cancelado" => "badge-cancelado",
                    _ => "bg-secondary text-white"
                };
            }
            <span class="badge @estadoClase text-capitalize">@Model.EstadoInstalacion</span>
        </div>

        <div class="detalle-card" style="grid-column: span 2;">
            <h6>Observaciones</h6>
            <p>@Model.Observaciones</p>
        </div>
    </div>

    <div class="d-flex justify-content-end mt-4">
        <a asp-action="Index" class="btn btn-back">
            <i class="bi bi-arrow-left-circle"></i> Volver al listado
        </a>
    </div>
</div>
