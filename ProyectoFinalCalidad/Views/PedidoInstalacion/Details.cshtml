@model ProyectoFinalCalidad.Models.PedidoInstalacion

@{
    ViewData["Title"] = "Detalle del Pedido de Instalación";
}

<style>

    body {
        background-color: #f0f8ff;
    }

    .detalle-container {
        background: #f1f4f6;
        padding: 2rem;
        border-radius: 1rem;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
        margin-top: 3rem;
    }

    .detalle-header {
        font-weight: bold;
        color: #ffffff;
        background: linear-gradient(to right, #0F2027, #203A43, #2C5364);
        padding: 1rem 1.5rem;
        border-radius: 0.75rem 0.75rem 0 0;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .detalle-body {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
        padding: 2rem;
        background-color: white;
        border-radius: 0 0 0.75rem 0.75rem;
    }

    .detalle-card {
        background-color: #ffffff;
        border-left: 5px solid #203A43;
        border-radius: 0.75rem;
        padding: 1.5rem;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.05);
        display: flex;
        flex-direction: column;
        justify-content: center;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

        .detalle-card:hover {
            transform: scale(1.02);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
        }

        .detalle-card h6 {
            font-size: 1rem;
            color: #6c757d;
            margin-bottom: 0.25rem;
        }

        .detalle-card p {
            font-size: 1.2rem;
            font-weight: 600;
            color: #203A43;
            margin: 0;
        }

    .resumen {
        grid-column: span 2;
        background: linear-gradient(to right, #0F2027, #203A43, #2C5364);
        color: white;
        border-radius: 0.75rem;
        padding: 1.5rem;
        text-align: center;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease-in-out;
    }

        .resumen:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 28px rgba(0, 0, 0, 0.12);
        }

        .resumen h4 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .resumen p {
            font-size: 1.1rem;
            margin: 0;
        }

    .badge {
        font-weight: 600;
        font-size: 0.9rem;
        padding: 0.4rem 0.8rem;
        border-radius: 0.5rem;
        display: inline-block;
    }

    .badge-pendiente {
        background-color: #fbc02d;
        color: #212529;
    }

    .badge-completado {
        background-color: #397DA9;
        color: #fff;
    }

    .badge-cancelado {
        background-color: #c62828;
        color: #fff;
    }

    .btn-back {
        font-weight: bold;
        padding: 0.75rem 1.6rem;
        font-size: 1.1rem;
        border-radius: 0.5rem;
        border: none;
        background-color: #397DA9;
        color: white;
        transition: all 0.3s ease, box-shadow 0.3s ease;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

        .btn-back:hover {
            background-color: #2f6e93;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }

        .btn-back i {
            margin-right: 0.5rem;
        }
</style>

<div class="container detalle-container">
    <div class="detalle-header">
        <i class="bi bi-eye-fill fs-3"></i> @ViewData["Title"]
    </div>

    <div class="detalle-body">
        <!-- Resumen Superior -->
        <div class="resumen">
            <h4><i class="bi bi-info-circle-fill"></i> Resumen Rápido</h4>
            <p>
                Pedido registrado por <strong>@Model.Empleado?.nombres</strong> para el contrato del cliente
                <strong>@Model.Contrato?.Cliente?.Nombres</strong>.
            </p>
        </div>

        <div class="detalle-card">
            <h6>ID del Pedido</h6>
            <p>@Model.PedidoId</p>
        </div>

        <div class="detalle-card">
            <h6>Contrato</h6>
            <p>Contrato #@Model.Contrato?.Id</p>
            <small class="text-muted">Cliente: @Model.Contrato?.Cliente?.Nombres</small>
        </div>

        <div class="detalle-card">
            <h6>Empleado asignado</h6>
            <p>@Model.Empleado?.nombres</p>
        </div>

        <!-- Jefe a cargo -->
        <div class="detalle-card">
            <h6>Jefe a cargo</h6>
            @{
                // Lógica para obtener el jefe (puedes adaptarlo a tu fuente real)
                var cargoClaim = User.Claims.FirstOrDefault(c => c.Type == "Cargo")?.Value;
                var rolClaim = User.Claims.FirstOrDefault(c => c.Type == System.Security.Claims.ClaimTypes.Role)?.Value;

                string jefeACargo;

                if (!string.IsNullOrEmpty(rolClaim) && rolClaim == "Administrador")
                {
                    jefeACargo = "Administrador General";
                }
                else if (!string.IsNullOrEmpty(cargoClaim))
                {
                    jefeACargo = cargoClaim;
                }
                else
                {
                    jefeACargo = "Sin cargo";
                }
            }
            <p>@jefeACargo</p>
        </div>

        <div class="detalle-card">
            <h6>Fecha de instalación</h6>
            <p>@Model.FechaInstalacion?.ToString("dd/MM/yyyy")</p>
        </div>

        <div class="detalle-card">
            <h6>Estado</h6>
            @{
                var estado = Model.EstadoInstalacion?.ToLower() ?? "";
                string estadoClase = estado switch
                {
                    "pendiente" => "badge-pendiente",
                    "completado" => "badge-completado",
                    "cancelado" => "badge-cancelado",
                    _ => "bg-secondary text-white"
                };
            }
            <span class="badge @estadoClase text-capitalize">@Model.EstadoInstalacion</span>
        </div>

        <div class="detalle-card" style="grid-column: span 2;">
            <h6>Observaciones</h6>
            <p>@Model.Observaciones</p>
        </div>
    </div>

    <div class="d-flex justify-content-end mt-4">
        <a asp-action="Index" class="btn btn-back">
            <i class="bi bi-arrow-left-circle"></i> Volver al listado
        </a>
    </div>
</div>
